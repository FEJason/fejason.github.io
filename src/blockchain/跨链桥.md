# Web 端跨链桥开发

**项目名称**：跨链桥（Cross-Chain Bridge）前端开发  
**适用对象**：Vue 前端开发工程师  
**目标**：掌握实现一个支持多链、多资产的跨链桥 Web 前端所需的核心知识与技能  
**当前时间**：2025 年 10 月 29 日

---

## 一、项目概述

本项目是一个基于 **Vue 3** 的 Web 端跨链桥应用，支持用户在不同公链之间转移资产。

### 核心功能

- 用户连接钱包（支持 WalletConnect、注入式钱包等）
- 选择源链（如 TRON Mainnet）和源代币
- 选择目标链和目标代币
- 输入跨链金额，点击“跨链”
- 显示跨链进度与结果

---

## 二、Web 端需要掌握的核心知识

### 1. **Vue 3 + 组合式 API（Composition API）**

- 熟练使用 `ref`、`reactive`、`computed`、`watch`
- 使用 `onMounted`、`onUnmounted` 等生命周期钩子
- 使用 `defineComponent` 或 `<script setup>` 语法

> ✅ **学习资源**：
>
> - [Vue 3 官方文档](https://vuejs.org/guide/introduction.html)

---

### 2. **Web3 钱包连接（Wallet Connection）**

- 理解主流钱包类型：
  - **注入式钱包**：MetaMask（浏览器插件）
  - **移动端钱包**：Trust Wallet、Rainbow、Bitget Wallet
  - **嵌入式钱包**：通过邮箱创建的钱包（如 Web3Auth、Reown AppKit）
- 掌握钱包连接方式：
  - 使用 **WalletConnect** 协议扫码连接手机钱包
  - 使用 **注入式 Provider**（如 `window.ethereum`）

> ✅ **关键技术栈**：
>
> - `@reown/appkit/vue`（推荐，集成 WalletConnect + UI）
> - `wagmi`（React/Vue Web3 工具库）
> - `ethers.js` 或 `viem`（与区块链交互）

---

### 3. **跨链桥交互流程（关键！）**

#### 用户操作流程：

```text
1. 连接钱包 → 2. 选择源链 → 3. 选择源代币 → 4. 选择目标链 → 5. 选择目标代币 → 6. 输入金额 → 7. 点击“跨链” → 8. 等待结果
```

#### 前端职责：

| 步骤 | 前端任务                                                   |
| ---- | ---------------------------------------------------------- |
| 1    | 调用 `appKit.open()` 或 `connect()` 连接钱包               |
| 2-5  | 提供下拉菜单，显示支持的链和代币（数据来自后端或配置文件） |
| 6    | 表单输入，校验金额（是否为正数、是否超过余额）             |
| 7    | 调用合约或触发跨链流程（见下文）                           |
| 8    | 显示交易哈希、轮询状态、展示成功/失败                      |

---

### 4. **与区块链交互（Smart Contract Calls）**

#### 跨出（Outbound）流程：

- 用户需先将资产“锁定”到桥接合约
- 前端调用源链上的 `lock()` 或 `bridge()` 合约方法
- 使用钱包签名交易

```js
// 示例：使用 wagmi 发送交易
const { writeContract } = useContractWrite({
  address: '0x...', // 桥接合约地址
  abi: bridgeABI,
  functionName: 'lock',
  args: [amount, targetChainId, userAddress]
})

writeContract()
```

#### 跨入（Inbound）：

- 通常由后端在目标链释放资产，前端只需监听状态

---

### 5. **链与代币配置管理**

#### 需要维护的数据：

```js
// 支持的链
const chains = [
  { id: 1, name: 'Ethereum', rpc: 'https://eth-mainnet.alchemyapi.io/v2/...' },
  { id: 728126428, name: 'TRON Mainnet', rpc: 'https://api.trongrid.io' }
  // ...
]

// 支持的代币（每条链不同）
const tokens = {
  728126428: [
    // TRON 链
    {
      symbol: 'USDT',
      address: 'TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t',
      decimals: 6
    },
    { symbol: 'TRX', address: 'native', decimals: 6 }
  ]
  // ...
}
```

> ✅ 建议：将配置放在 `/config/chains.js` 或通过 API 从后端获取

---

### 6. **余额查询（Balance Check）**

- 使用 `ethers.js` 或 `wagmi` 查询用户余额
- 区分原生币（如 TRX）和代币（如 USDT）

```js
// 查询代币余额
const balance = await readContract({
  address: tokenAddress,
  abi: erc20ABI,
  functionName: 'balanceOf',
  args: [userAddress]
})
```

---

### 7. **交易状态监听与反馈**

- 显示交易哈希（txHash）
- 轮询交易是否上链（通过 RPC）
- 调用后端 API 查询跨链进度（如：锁定中、释放中、已完成）

```js
// 示例：轮询跨链状态
const checkStatus = async txHash => {
  const res = await fetch(`/api/bridge/status?tx=${txHash}`)
  const data = await res.json()
  return data.status // pending, success, failed
}
```

---

### 8. **UI/UX 设计要点**

| 功能         | 建议实现                                                              |
| ------------ | --------------------------------------------------------------------- |
| 钱包连接按钮 | 显示“Connect Wallet”，连接后显示地址缩写（如 `0x123...abc`）          |
| 链选择器     | 图标 + 名称，支持搜索                                                 |
| 代币选择器   | 搜索框 + 列表，显示余额                                               |
| 跨链按钮     | 状态化：`Enter Amount` → `Approve` → `Bridge` → `Pending` → `Success` |
| 错误提示     | 清晰提示余额不足、网络错误、交易失败等                                |

---

### 9. **安全注意事项（前端）**

| 风险     | 防范措施                                 |
| -------- | ---------------------------------------- |
| 私钥泄露 | ❌ 绝不存储用户私钥或助记词              |
| 伪造交易 | 后端必须独立验证链上交易，前端数据不可信 |
| 重放攻击 | 使用 nonce 或 txHash 去重                |
| 网络劫持 | 使用 HTTPS，验证合约地址来源             |

> 🔐 **核心原则**：前端只负责交互，**资产操作必须由用户钱包签名，后端验证。**

---

### 10. **调试与测试**

| 工具                       | 用途         |
| -------------------------- | ------------ |
| TronLink / MetaMask 测试网 | 测试钱包连接 |
| TronGrid Testnet           | TRON 链测试  |
| Sepolia / BSC Testnet      | 其他链测试   |
| Postman                    | 测试后端 API |
| Vue DevTools               | 调试组件状态 |

---

## 三、推荐技术栈

| 类别     | 推荐技术                                    |
| -------- | ------------------------------------------- |
| 前端框架 | Vue 3 + Vite                                |
| UI 库    | Element Plus / Ant Design Vue               |
| Web3 库  | `@reown/appkit/vue` + `wagmi` + `ethers.js` |
| 状态管理 | `pinia`（可选）                             |
| 构建工具 | Vite                                        |
| 代码规范 | ESLint + Prettier                           |

---

## 四、开发流程建议

1. ✅ **第 1 步：搭建基础项目**

   - 创建 Vue 3 项目
   - 集成 AppKit，实现钱包连接

2. ✅ **第 2 步：实现链与代币选择**

   - 静态配置支持的链和代币
   - 实现下拉选择组件

3. ✅ **第 3 步：余额查询**

   - 获取用户地址后，查询当前链的余额

4. ✅ **第 4 步：跨链交易调用**

   - 集成桥接合约 ABI
   - 实现 `lock` 交易发送

5. ✅ **第 5 步：状态反馈**

   - 显示 txHash
   - 调用后端 API 查询进度

6. ✅ **第 6 步：UI 优化与测试**
   - 美化界面
   - 多钱包、多链测试

---

## 五、常见问题（FAQ）

### Q1：TRON 链和其他 EVM 链有什么不同？

- TRON 不是 EVM 兼容链，使用自己的虚拟机（TVM）
- 需使用 `tronweb` 库而非 `ethers.js`
- 交易结构、地址格式（base58 vs hex）不同
- **解决方案**：如果支持 TRON，需单独集成 `tronweb`，或使用跨链协议（如 IBC、LayerZero）封装

> ⚠️ 本培训假设所有链为 EVM 兼容链。如需支持 TRON，需额外开发。

### Q2：用户点击“跨链”后，前端要做什么？

1. 校验输入
2. 如果是代币，先检查是否已授权（Approve），未授权则先发起 `approve` 交易
3. 授权完成后，调用桥接合约的 `lock` 方法
4. 等待用户钱包签名
5. 获取 txHash，显示“交易已提交”
6. 轮询后端 API 获取跨链状态

---

## 六、总结

作为 Web 端开发者，你需要掌握：

| 能力            | 说明                           |
| --------------- | ------------------------------ |
| ✅ 钱包连接     | 使用 AppKit/Wagmi 连接用户钱包 |
| ✅ 链与代币管理 | 配置并展示支持的链和资产       |
| ✅ 余额查询     | 调用合约读取用户余额           |
| ✅ 交易发送     | 调用桥接合约，用户签名         |
| ✅ 状态反馈     | 显示进度，调用后端 API         |
| ✅ 安全意识     | 不碰私钥，信任后端验证         |

> 💡 **记住**：你不是在“转账”，而是在“触发一个跨链流程”。真正的资产转移由后端或智能合约完成。

---

**培训结束**  
下一步：动手搭建一个测试项目，连接钱包，调用一个测试合约！🚀
